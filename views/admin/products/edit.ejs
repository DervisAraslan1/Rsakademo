<div class="content-header">
    <h2 class="content-title">
        <i class="fas fa-edit"></i>
        Ürün Düzenle
    </h2>
    <a href="/admin/products" class="btn-furniture" style="background: #6c757d; color: white;">
        <i class="fas fa-arrow-left"></i>
        Geri Dön
    </a>
</div>

<form action="/admin/products/<%= product.id %>/update" method="POST" enctype="multipart/form-data">
    <div class="row">
        <div class="col-lg-8">
            <!-- Ürün Bilgileri -->
            <div class="card mb-4" style="border: 2px solid rgba(139, 69, 19, 0.1); border-radius: 10px;">
                <div class="card-body" style="background: rgba(247, 243, 233, 0.5);">
                    <h5 class="card-title" style="color: var(--oak-brown); margin-bottom: 20px;">
                        <i class="fas fa-info-circle"></i> Ürün Bilgileri
                    </h5>

                    <div class="mb-3">
                        <label for="name" class="form-label" style="font-weight: 600; color: var(--walnut);">
                            Ürün Adı <span style="color: red;">*</span>
                        </label>
                        <input type="text" class="form-control" id="name" name="name" required
                            value="<%= product.name %>"
                            style="border: 2px solid rgba(139, 69, 19, 0.2); border-radius: 8px;">
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label" style="font-weight: 600; color: var(--walnut);">
                            Açıklama
                        </label>
                        <textarea class="form-control" id="description" name="description" rows="5"
                            style="border: 2px solid rgba(139, 69, 19, 0.2); border-radius: 8px;"><%= product.description || '' %></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="width" class="form-label" style="font-weight: 600; color: var(--walnut);">
                                Genişlik (cm)
                            </label>
                            <input type="number" class="form-control" id="width" name="width" step="0.1"
                                value="<%= typeof width !== 'undefined' ? width : '' %>" placeholder="Örn: 200"
                                style="border: 2px solid rgba(139, 69, 19, 0.2); border-radius: 8px;">
                        </div>

                        <div class="col-md-4 mb-3">
                            <label for="height" class="form-label" style="font-weight: 600; color: var(--walnut);">
                                Yükseklik (cm)
                            </label>
                            <input type="number" class="form-control" id="height" name="height" step="0.1"
                                value="<%= typeof height !== 'undefined' ? height : '' %>" placeholder="Örn: 150"
                                style="border: 2px solid rgba(139, 69, 19, 0.2); border-radius: 8px;">
                        </div>

                        <div class="col-md-4 mb-3">
                            <label for="depth" class="form-label" style="font-weight: 600; color: var(--walnut);">
                                Derinlik (cm)
                            </label>
                            <input type="number" class="form-control" id="depth" name="depth" step="0.1"
                                value="<%= typeof depth !== 'undefined' ? depth : '' %>" placeholder="Örn: 80"
                                style="border: 2px solid rgba(139, 69, 19, 0.2); border-radius: 8px;">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ürün Görselleri -->
            <div class="card" style="border: 2px solid rgba(139, 69, 19, 0.1); border-radius: 10px;">
                <div class="card-body" style="background: rgba(247, 243, 233, 0.5);">
                    <h5 class="card-title" style="color: var(--oak-brown); margin-bottom: 20px;">
                        <i class="fas fa-images"></i> Ürün Görselleri
                    </h5>

                    <!-- Mevcut Görseller -->
                    <% if (product.images && Array.isArray(product.images) && product.images.length> 0) { %>
                        <div class="row mb-3">
                            <% product.images.forEach((image, index)=> { %>
                                <div class="col-md-3 mb-3">
                                    <div style="position: relative;">
                                        <img src="<%= image %>" alt="Product image" class="img-fluid"
                                            style="border-radius: 8px; border: 2px solid rgba(139, 69, 19, 0.2);">
                                        <button type="button" class="btn btn-danger btn-sm"
                                            style="position: absolute; top: 5px; right: 5px;"
                                            onclick="alert('Görsel silme özelliği yakında eklenecek')">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                <% }) %>
                        </div>
                        <% } else { %>
                            <p class="text-muted">Henüz görsel eklenmemiş</p>
                            <% } %>

                                <!-- Yeni Görsel Ekle -->
                                <div class="mb-3">
                                    <label for="images" class="form-label"
                                        style="font-weight: 600; color: var(--walnut);">
                                        Yeni Görseller Ekle (En fazla 5 adet)
                                    </label>
                                    <input type="file" class="form-control" id="images" name="images" multiple
                                        accept="image/*"
                                        style="border: 2px solid rgba(139, 69, 19, 0.2); border-radius: 8px;">
                                    <small class="text-muted">JPG, PNG veya WebP formatında yükleyebilirsiniz.</small>
                                </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Kategoriler -->
            <div class="card mb-4" style="border: 2px solid rgba(139, 69, 19, 0.1); border-radius: 10px;">
                <div class="card-body" style="background: rgba(247, 243, 233, 0.5);">
                    <h5 class="card-title" style="color: var(--oak-brown); margin-bottom: 20px;">
                        <i class="fas fa-tags"></i> Kategoriler <span style="color: red;">*</span>
                    </h5>

                    <% if (categories && categories.length> 0) { %>
                        <div id="category-selection">
                            <% const selectedCategoryIds=product.categories ? product.categories.map(c=> c.id) : [];
                                %>
                                <% categories.forEach(category=> { %>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input category-checkbox" type="checkbox"
                                            name="categories" value="<%= category.id %>" id="cat-<%= category.id %>"
                                            <%=selectedCategoryIds.includes(category.id) ? 'checked' : '' %>>
                                        <label class="form-check-label" for="cat-<%= category.id %>"
                                            style="font-weight: 500;">
                                            <%= category.name %>
                                        </label>
                                    </div>
                                    <% }) %>
                        </div>
                        <small class="text-danger d-none" id="category-error">En az bir kategori seçmelisiniz!</small>
                        <% } else { %>
                            <p class="text-muted">Henüz kategori yok</p>
                            <a href="/admin/categories/create" class="btn btn-sm btn-outline-primary">
                                Kategori Ekle
                            </a>
                            <% } %>
                </div>
            </div>

            <!-- Butonlar -->
            <div class="d-grid gap-2">
                <button type="submit" class="btn-furniture btn-primary-furniture"
                    style="width: 100%; justify-content: center;">
                    <i class="fas fa-save"></i>
                    Değişiklikleri Kaydet
                </button>
                <a href="/admin/products" class="btn-furniture"
                    style="background: #6c757d; color: white; justify-content: center;">
                    <i class="fas fa-times"></i>
                    İptal
                </a>
            </div>
        </div>
    </div>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.querySelector('form');
        const categoryCheckboxes = document.querySelectorAll('.category-checkbox');
        const categoryError = document.getElementById('category-error');

        form.addEventListener('submit', function (e) {
            const isAnyCategoryChecked = Array.from(categoryCheckboxes).some(cb => cb.checked);

            if (!isAnyCategoryChecked) {
                e.preventDefault();
                categoryError.classList.remove('d-none');

                document.getElementById('category-selection').scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });

                return false;
            }

            categoryError.classList.add('d-none');
        });

        categoryCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function () {
                if (Array.from(categoryCheckboxes).some(cb => cb.checked)) {
                    categoryError.classList.add('d-none');
                }
            });
        });
    });
</script>